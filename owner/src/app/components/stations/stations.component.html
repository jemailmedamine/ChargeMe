<!-- stationlist.component.html -->

<h1>Stations</h1>

<div class="from-outline mt-3">
  <form>
    <input class="form-control" [(ngModel)]="name" list="datalistOptions" id="exampleDataList" name="exampleDataList"  placeholder="Type to search..."
    style="width: 300px;height: 35px;border-radius: 50px;">
  
  <button type="button" (click)="filrage()" class="btn btn-outline" style="height: 35px; border-radius: 50px;background-color: rgba(65.66, 187.93, 35.10, 0.50);">
    <i class="fa fa-filter" aria-hidden="true"></i> filter
  </button>
    <button type="button" class="btn btn-outline-warning" (click)="openCreatePopup()" style="border-radius: 50px;height: 35px;">
      <i class="fa fa-plus" aria-hidden="true"></i>create
    </button>
  </form>
</div>

<!-- stationlist.component.html -->



<div class="table mt-3">
  <table class="table table-striped table-hover" style="width: 100%">
    <thead>
      <tr>
        <th scope="col">Name</th>
        <th scope="col">Address</th>
        <th scope="col">Phone</th>
        <th scope="col">Statue</th>
        <th scope="col">Number of Terminal</th>
        <th scope="col">Number of Moderator</th>
        <th scope="col">Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let sta of allstation.stationborn">
        <td>{{ sta.station?.name }}</td>
        <td>{{ sta.station?.adresse }}</td>
        <td>{{ sta.station?.telf }}</td>
        <td>
          <ng-container *ngIf="sta.station?.confirmationAdmin == 'enCour'; else confirmed">
            being confirmed
          </ng-container>
          <ng-template #confirmed>
            <ng-container *ngIf="sta.station?.confirmationAdmin == 'Confirmer'; else notConfirmed">
              confirmed
            </ng-container>
          </ng-template>
          <ng-template #notConfirmed>
            Inconnue !!!!!!
          </ng-template></td>
        <td>{{ sta.borns?.length }}</td>
        <td>{{ sta.moderteurs?.length }}</td>
        <td>
          <i class="fa fa-pencil" aria-hidden="true" (click)="openEditPopup(sta.station)" style="padding: 5px; color: grey;"></i>
          <!-- <i class="fa fa-trash" aria-hidden="true" (click)="openDeletePopup(sta.station?.id)" style="padding: 5px; color: grey;"></i> -->
          <i class="fa fa-eye" aria-hidden="true" (click)="toggleDetails(sta)" style="padding: 5px; color: grey;"></i>
          <i class="fa fa-plus" aria-hidden="true" (click)="openModeratorPopup(sta.station?.id)" style="padding: 5px; color: grey;"></i>
        </td>
      </tr>
      <tr *ngIf="showStationDetailsPopup">
        <td colspan="7"> <!-- Spanning across all columns -->
          <h2>Station Details</h2>
          <table class="table"> <!-- Nested table for station details -->
            <tr>
              <td class="station-detail"><strong>Register Number:</strong> {{ selectedStation?.registerNumber }}</td>
              <td class="station-detail"><strong>Address:</strong> {{ selectedStation?.address }}</td>
              <td class="station-detail"><strong>Station Name:</strong> {{ selectedStation?.stationName}}</td>
            </tr>
            <tr>
              <td class="station-detail"><strong>State:</strong> 
                <ng-container *ngIf="selectedStation?.state == 'fermer'; else ativer">
                  Inactive
                </ng-container>
                <ng-template #ativer>
                  <ng-container *ngIf="selectedStation?.state == 'ouvert'; else notativer">
                     Active
                  </ng-container>
                </ng-template>
                <ng-template #notativer>
                  Inconnue !!!!!!
                </ng-template>
              </td>
              <td class="station-detail"><strong>Admin Confirmation:</strong> 
                <ng-container *ngIf="selectedStation.adminConfirmation == 'enCour'; else confirmed">
                  being confirmed
                </ng-container>
                <ng-template #confirmed>
                  <ng-container *ngIf="selectedStation.adminConfirmation == 'Confirmer'; else notConfirmed">
                    confirmed
                  </ng-container>
                </ng-template>
                <ng-template #notConfirmed>
                  Inconnue !!!!!!
                </ng-template>
              </td>
              <td class="station-detail"><strong>Price per KW:</strong> {{ selectedStation?.pricePerKW }}</td>
            </tr>
            <tr>
              <td class="station-detail"><strong>Phone:</strong> {{ selectedStation?.phone }}</td>
              <td class="station-detail"><strong>Admin Name:</strong>{{ adminStation.firstname }} {{ adminStation.firstname }}</td>
              <td class="station-detail"><strong>Admin Email:</strong> {{ adminStation.login }}</td>
            </tr>
          </table>
          <hr />
          <div style="display: flex; margin-top: 20px;">
  <!-- Terminals List -->
  <div style="flex: 1; margin-right: 20px;">
    <h2 style="margin-bottom: 20px;">Terminals' List</h2>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Serial Number</th>
          <th>Name</th>
          <th>State</th>
          <th>Phone Number</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let terminal of allborn.borns">
          <td>{{ terminal.serialNumber }}</td>
          <td>{{ terminal.name }}</td>
          <td>
            <ng-container *ngIf="terminal.etatB == 'Dispo'">Available</ng-container>
            <ng-container *ngIf="terminal.etatB == 'Reserver'">Booked</ng-container>
            <ng-container *ngIf="terminal.etatB == 'EnPanne'">Out of order</ng-container>
          </td>
          <td>{{ terminal.NumeroTel }}</td>
        </tr>
      </tbody>
    </table>
    <nav aria-label="Page navigation example">
      <ul class="pagination justify-content-end">
        <li class="page-item">
          <button class="page-link" (click)="PreviousB()">Previous</button>
        </li>
        <li class="page-item">
          <button class="page-link" (click)="nextB()">Next</button>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Vertical Line -->
  <div style="border-left: 1px solid black; margin: 0 20px;"></div>

  <!-- Moderators List -->
  <div style="flex: 1;">
    <h2 style="margin-bottom: 20px;">Moderators' List</h2>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Name</th>
          <th>Login</th>
          <th>Phone</th>
          <th>State</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let moderator of allmoderateur.moderateurs">
          <td>{{ moderator.firstname }}{{ moderator.lastname }}</td>
          <td>{{ moderator.login }}</td>
          <td>{{ moderator.phone }}</td>
          <td>
            <ng-container *ngIf="moderator.etat == 'actif'">active</ng-container>
            <ng-container *ngIf="moderator.etat == 'inactif'">inactive</ng-container>
          </td>
          <td>
            <button class="btn btn-outline" (click)="openModeratorEditPopup(moderator)">
              <i class="fa fa-pen" aria-hidden="true"></i>
            </button>&nbsp;
            <button class="btn btn-outline" (click)="openModeratorDeletePopup()">
              <i class="fa fa-trash" aria-hidden="true"></i>
            </button>&nbsp;
          </td>
        </tr>
      </tbody>
    </table>
    <nav aria-label="Page navigation example">
      <ul class="pagination justify-content-end">
        <li class="page-item">
          <button class="page-link" (click)="PreviousMod()">Previous</button>
        </li>
        <li class="page-item">
          <button class="page-link" (click)="nextMod()">Next</button>
        </li>
      </ul>
    </nav>
  </div>
</div>

        </td>
      </tr>
    </tbody>
  </table>
</div>

  


<div class="popup-container" *ngIf="showModeratorDelete">
  <div class="popup">
    <h2>Delete Moderator</h2>
    <p>Are you sure you want to delete this Moderator?</p>
    <button type="button" class="btn btn-primary" (click)="openModeratorDeleteSuccessPopup()">Yes, Delete</button>
    <button type="button" class="btn btn-secondary ms-3" (click)="closePopup()">Cancel</button>
  </div>
</div> 
<div class="popup-container" *ngIf="showModeratorDeleteSuccessPopup">
  <div class="popup">
    <h2>Moderator Deleted!</h2>
    <button type="button" class="btn btn-primary" (click)="closePopup()">Dismiss</button>
  </div>
</div>




<nav aria-label="Page navigation example">
  <ul class="pagination justify-content-end" >
    <li class="page-item ">
     <!--<a class="page-link">Previous</a>-->
     <button class="page-link" (click)="Previous()">Previous</button>
    </li >
    <!--<li class="page-item"><a class="page-link" href="#">1</a></li>
    <li class="page-item"><a class="page-link" href="#">2</a></li>
    <li class="page-item"><a class="page-link" href="#">3</a></li>-->
    <li class="page-item">
      <!--<a class="page-link" href="#">Next</a>-->
      <button class="page-link" (click)="next()">Next</button>
    </li>
  </ul>
</nav>
<!--<div class="station-details" *ngIf="selectedStation">
  <h2>Détails de la station</h2>
  <div>
    <p><strong>Nom de la station:</strong> {{ selectedStation.name }}</p>
    <p><strong>Adresse:</strong> {{ selectedStation.address }}</p>
    <p><strong>Téléphone:</strong> {{ selectedStation.phone }}</p>
    <p><strong>Statut:</strong> {{ selectedStation.status }} </p>
    <p><strong>Nombre de borne:</strong> {{ selectedStation.numberofborne }}</p>
  </div>
</div>-->
<div class="popup-container" *ngIf="showStationCreatePopup">
  <div class="popup">
    <h2>Create Station</h2>
    <form #createStationForm="ngForm" (submit)="submitCreateStationForm($event)">
      <div class="row mb-3"> 
        <div class="col">
          <label for="stationName" class="form-label">Name</label>
          <input type="text" class="form-control" id="stationName" [(ngModel)]="createStation.name" name="stationName" required >
        </div>
        </div>
        <div class="row mb-3">
          <div class="col">
          <label for="registerNumber" class="form-label">Register Number</label>
          <input type="text" class="form-control" id="registerNumber" [(ngModel)]="createStation.registerNumber" name="registerNumber" required>
          <label id="alertexist" style="color: red;display: none;"> This Number exists</label>
        </div>
       </div>
      <div class="row mb-3">
        <div class="col">
          <label for="stationAddress" class="form-label">Address</label>
          <input type="text" class="form-control" id="stationAddress" [(ngModel)]="createStation.address" name="stationAddress"required >
        </div>
      </div>
      <div class="row mb-3">
        <div class="col">
          <label for="stationPhone" class="form-label">Phone Number</label>
          <input type="tel" class="form-control" id="stationPhone" [(ngModel)]="createStation.phone" name="stationPhone" required>
        </div>
      </div>
      <div>
        <button type="submit" class="btn btn-primary" style="margin-top: 10px;" [disabled]="!createStationForm.valid" >Save</button>
        <button type="button" class="btn btn-secondary ms-3" style="margin-top: 10px;" (click)="closeCreatePopup()">Cancel</button>
      </div>
    </form>
  </div>
</div>
<!-- //////////////////////////////////////////////////////////////////////////////////////////////////////// -->
<div class="popup-container" *ngIf="showStationEditPopup">
  <div class="popup">
    <h2>Edit Station</h2>
    <form (submit)="submitEditStationForm($event)" #EditStationForm="ngForm">
      <div class="row mb-3"> 
        <div class="col">
          <label for="stationName" class="form-label">Name</label>
          <input type="text" class="form-control" id="stationName" [(ngModel)]="EditStation.name" name="stationName" required >
        </div>
        </div>
        <div class="row mb-3">
          <div class="col">
          <label for="registerNumber" class="form-label">Register Number</label>
          <input type="text" class="form-control" id="registerNumber" [(ngModel)]="EditStation.registreNumber" name="registerNumber" required>
          <label id="alertexist" style="color: red;display: none;"> This Number exists</label>
        </div>
       </div>
      <div class="row mb-3">
        <div class="col">
          <label for="stationAddress" class="form-label">Address</label>
          <input type="text" class="form-control" id="stationAddress" [(ngModel)]="EditStation.adresse" name="stationAddress"required >
        </div>
      </div>
      <div class="row mb-3">
        <div class="col">
          <label for="stationPhone" class="form-label">Phone Number</label>
          <input type="tel" class="form-control" id="stationPhone" [(ngModel)]="EditStation.telf" name="stationPhone" required>
        </div>
      </div>
      <div>
        <button type="submit" class="btn btn-primary" style="margin-top: 10px;" [disabled]="!EditStationForm.valid" >Save</button>
        <button type="button" class="btn btn-secondary ms-3" style="margin-top: 10px;" (click)="closeEditPopup()">Cancel</button>
      </div>
    </form>
  </div>
</div>
<!-- //////////////////////////////////////////////////////////////////////////////////////////////////////// -->
<div class="popup-container" *ngIf="showStationSuccessPopup">
  <div class="popup">
    <h2>Station Created!</h2>
    <button type="button" class="btn btn-primary" (click)="closeCreatePopup()">Dismiss!</button>
  </div>
</div>
  <div class="popup-container" *ngIf="showDeletePopup">
    <div class="popup">
      <h2>Delete Station</h2>
      <p>Are you sure you want to delete this Station?</p>
      <button type="button" class="btn btn-primary" (click)="deleteStation()">Yes, Delete</button>
      <button type="button" class="btn btn-secondary ms-3" (click)="cancelDelete()">Cancel</button>
    </div>
  </div>
  <div class="popup-container" *ngIf="showDeleteSuccessPopup">
    <div class="popup">
      <h2>Station Deleted!</h2>
      <button type="button" class="btn btn-primary" (click)="closeDeleteSuccessPopup()">Dismiss</button>
    </div>
  </div>
<div class="popup-container" *ngIf="showStationEditSuccessPopup">
  <div class="popup">
    <h2>Station Edited!</h2>
    <button type="button" class="btn btn-primary" (click)="closeEditPopup()">Dismiss!</button>
  </div>
</div>
<div class="popup-container" *ngIf="showModeratorCreatePopup">
  <div class="popup">
    <h2>Create Moderator</h2>
    <form  (submit)="submitcreateModeratorForm($event)" #createModerateurForm="ngForm">
      <div class="row mb-3">
        <div class="col">
          <label for="ModeratorName" class="form-label"> First Name</label>
          <input type="text" class="form-control" id="ModeratorFirstName" [(ngModel)]="moderateur.firstname" name="ModeratorFirstName" required>
       
        </div>
        <div class="col">
          <label for="ModeratorName" class="form-label">Last Name</label>
          <input type="text" class="form-control" id="ModeratorLastName" name="ModeratorLastName"[(ngModel)]="moderateur.lastname"  required>
        
        </div>
      </div>
      <div class="row mb-3">
        <div class="col">
          <label for="ModeratorName" class="form-label">Login</label>
          <input type="text" class="form-control" id="ModeratorLogin" name="ModeratorLogin" [(ngModel)]="moderateur.login"  required>
          <label id="alertLogin" style="color: red;display: none;"> This login is existed</label>
        </div>
        <div class="col">
          <label for="ModeratorName" class="form-label">Password</label>
          <input type="password" class="form-control" id="ModeratorPassword" name="ModeratorPassword" [(ngModel)]="moderateur.password"  required>
          
        </div>
      </div>
      <div class="row mb-3">
        <div class="col">
          <label for="ModeratorPhone" class="form-label">Phone</label>
          <input type="text" class="form-control" id="ModeratorPhone"  name="ModeratorPhone" [(ngModel)]="moderateur.phone" required>
        </div>
        <div class="col">
          <label for="ModeratorPhone" class="form-label">State</label>
          <select class="form-control" id="ModeratorState" name="ModeratorState" [(ngModel)]="moderateur.etat"  required>
            <option value="actif">Active</option>
            <option value="inactif">Inactive</option>
          </select>
        </div>
      </div>
      <div>
        <!-- <button type="submit" class="btn btn-primary" style="margin-top: 10px;" (click)="showModeratorSuccessPopup()">Save</button> -->
        <button type="submit" class="btn btn-primary" style="margin-top: 10px;" [disabled]="!createModerateurForm.valid" >Save</button>
        <button type="button" class="btn btn-secondary ms-3" style="margin-top: 10px;" (click)="closeModeratorCreatePopup()">Cancel</button>
      </div>
    </form>
  </div>
</div>

<div class="popup-container" *ngIf="ModeratorSuccessPopup">
  <div class="popup">
    <h2>Moderator Created!</h2>
    <button type="button" class="btn btn-primary" (click)="closeModeratorCreatePopup()">Dismiss!</button>
  </div>
</div>


<!-- //////////////////////////////////////////////////////////////////////////////// -->

<div class="popup-container" *ngIf="showModeratorEditPopup">
  <div class="popup">
    <h2>Edit Moderator</h2>
    <form #EditModeratorForm="ngForm"  (submit)="submitEditModeratorForm($event)" >
      <div class="row mb-3">
        <div class="col">
          <label for="ModeratorName" class="form-label"> First Name</label>
          <input type="text" class="form-control" id="ModeratorFirstName" name="ModeratorFirstName" [(ngModel)]="moderateur.firstname" required>
          <label id="alertname" style="color: red;display: none;"> This Name is existed</label>
        </div>
        <div class="col">
          <label for="ModeratorName" class="form-label">Last Name</label>
          <input type="text" class="form-control" id="ModeratorLastName" name="ModeratorLastName" [(ngModel)]="moderateur.lastname" required>
          <label id="alertname" style="color: red;display: none;"> This Name is existed</label>
        </div>
      </div>




      <div class="row mb-3">
        <div class="col">
          <label for="ModeratorName" class="form-label">Login</label>
          <input type="text" class="form-control" id="ModeratorLogin" name="ModeratorLogin" [(ngModel)]="moderateur.login" required>
          <label id="alertLoginEd" style="color: red;display: none;"> This Login is existed</label>
        </div>
        <div class="col">
          <label for="ModeratorName" class="form-label">Password</label>
          <input type="password" class="form-control" id="ModeratorPassword" name="ModeratorPassword" [(ngModel)]="moderateur.password" required>
          <label id="alertname" style="color: red;display: none;"> This Name is existed</label>
        </div>
      </div>




      <div class="row mb-3">
        <div class="col">
          <label for="ModeratorPhone" class="form-label">Phone</label>
          <input type="tel" class="form-control" id="ModeratorPhone" name="ModeratorPhone" [(ngModel)]="moderateur.phone" required>
        </div>
        <div class="col">
          <label for="ModeratorPhone" class="form-label">State</label>
          <select class="form-control" id="ModeratorState" name="ModeratorState" [(ngModel)]="moderateur.etat" required>
            <option value="actif">Active</option>
            <option value="inactif">Inactive</option>
          </select>
        </div>
      </div>
      <div>
        <!-- <button type="submit" class="btn btn-primary" style="margin-top: 10px;" (click)="showModeratorEditSuccessPopup()">Save</button> -->
        <button type="submit" class="btn btn-primary" style="margin-top: 10px;" [disabled]="!EditModeratorForm.valid" >Save</button>
        <button type="button" class="btn btn-secondary ms-3" style="margin-top: 10px;" (click)="closeModeratorEditPopup()">Cancel</button>
      </div>
    </form>
  </div>
</div>

<div class="popup-container" *ngIf="ModeratorEditSuccessPopup">
  <div class="popup">
    <h2>Moderator Edited!</h2>
    <button type="button" class="btn btn-primary" (click)="closeModeratorEditPopup()">Dismiss!</button>
  </div>
</div>